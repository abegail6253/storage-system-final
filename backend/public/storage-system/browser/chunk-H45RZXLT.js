import{H as K,I as Q}from"./chunk-HINXVPFU.js";import{a as h,b as P,c as w}from"./chunk-UEJFEWYP.js";import{$ as I,Cb as C,Eb as b,Gb as f,Kb as U,Lb as z,Mb as $,Ob as s,Pb as x,Qb as V,Sa as D,Va as l,W as M,Wa as v,Wb as N,Xb as R,Yb as A,bc as H,fb as S,ia as u,ib as E,ja as _,lb as m,sb as p,tb as k,tc as W,uc as j,vc as B,xb as o,yb as r,yc as q,zb as T}from"./chunk-DV5UHSU4.js";var y=class n{constructor(e){this.http=e}apiUrl="http://localhost:3001/my-files";getFiles(e){let t=new h().set("Authorization",`Bearer ${e}`);return this.http.get(this.apiUrl,{headers:t})}getFileStats(){return this.http.get("http://localhost:3001/files")}downloadFile(e){let t=localStorage.getItem("token"),i=new h().set("Authorization",`Bearer ${t}`),a=`http://localhost:3001/my-files/download/${e}`;return this.http.get(a,{headers:i,responseType:"blob"})}getFilePreview(e){let t=localStorage.getItem("token"),i=new h().set("Authorization",`Bearer ${t}`);return this.http.get(`http://localhost:3001/preview/${e}`,{headers:i})}renameFile(e,t){let i=localStorage.getItem("token"),a=new h().set("Authorization",`Bearer ${i}`);return this.http.put(`http://localhost:3001/my-files/${e}`,{newFileName:t},{headers:a})}static \u0275fac=function(t){return new(t||n)(I(w))};static \u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})};var X=["fileInput"],ee=n=>({"drag-over":n});function te(n,e){if(n&1&&(o(0,"div",7)(1,"p"),s(2),r()()),n&2){let t=f();l(2),x(t.uploadErrorMessage)}}function ne(n,e){if(n&1&&T(0,"img",14),n&2){let t=f(2),i=t.$implicit,a=t.index,d=f(2);p("src",d.filePreviews[a].preview,D)("alt","Preview of "+i.name)}}function ie(n,e){if(n&1&&(o(0,"div"),m(1,ne,1,2,"img",13),r()),n&2){let t=f().$implicit;l(),p("ngIf",t.type.startsWith("image/"))}}function oe(n,e){n&1&&(o(0,"mat-icon",17),s(1,"picture_as_pdf"),r())}function re(n,e){n&1&&(o(0,"mat-icon",17),s(1,"description"),r())}function ae(n,e){n&1&&(o(0,"mat-icon",17),s(1,"video_library"),r())}function se(n,e){n&1&&(o(0,"mat-icon",17),s(1,"grid_on"),r())}function le(n,e){n&1&&(o(0,"mat-icon",17),s(1,"archive"),r())}function de(n,e){if(n&1&&(o(0,"div",15),m(1,oe,2,0,"mat-icon",16)(2,re,2,0,"mat-icon",16)(3,ae,2,0,"mat-icon",16)(4,se,2,0,"mat-icon",16)(5,le,2,0,"mat-icon",16),r()),n&2){let t=f().$implicit,i=f(2);l(),p("ngIf",i.isPdf(t)),l(),p("ngIf",i.isWord(t)),l(),p("ngIf",i.isVideo(t)),l(),p("ngIf",i.isExcel(t)),l(),p("ngIf",i.isZip(t))}}function pe(n,e){if(n&1&&(o(0,"div")(1,"p"),s(2,"Uploading..."),r(),o(3,"div",19)(4,"div",20),s(5),r()()()),n&2){let t=f(2).$implicit,i=f(2);l(4),k("width",i.fileProgress[t.name],"%"),l(),V("",i.fileProgress[t.name],"%")}}function ce(n,e){n&1&&(o(0,"div")(1,"mat-icon",21),s(2,"check_circle"),r()())}function fe(n,e){if(n&1&&(o(0,"div",18),m(1,pe,6,3,"div",5)(2,ce,3,0,"div",5),r()),n&2){let t=f().$implicit,i=f(2);l(),p("ngIf",i.fileProgress[t.name]<100),l(),p("ngIf",i.fileProgress[t.name]===100)}}function me(n,e){if(n&1){let t=C();o(0,"tr")(1,"td"),m(2,ie,2,1,"div",5)(3,de,6,5,"div",10),r(),o(4,"td"),s(5),r(),o(6,"td"),s(7),r(),o(8,"td"),s(9),R(10,"formatFileSize"),r(),o(11,"td"),m(12,fe,3,2,"div",11),r(),o(13,"td")(14,"button",12),b("click",function(){let a=u(t).index,d=f(2);return _(d.removeFile(a))}),s(15,"Cancel"),r()()()}if(n&2){let t=e.$implicit,i=e.index,a=f(2);l(2),p("ngIf",a.filePreviews[i]==null?null:a.filePreviews[i].preview),l(),p("ngIf",!t.type.startsWith("image/")),l(2),x(t.name.length>20?t.name.slice(0,17)+"...":t.name),l(2),x(t.type),l(2),x(A(10,6,t.size)),l(3),p("ngIf",a.fileProgress[t.name]!==void 0)}}function ge(n,e){if(n&1&&(o(0,"div")(1,"h3"),s(2,"Selected Files"),r(),o(3,"table",8)(4,"thead")(5,"tr")(6,"th"),s(7,"Preview"),r(),o(8,"th"),s(9,"File Name"),r(),o(10,"th"),s(11,"File Type"),r(),o(12,"th"),s(13,"File Size"),r(),o(14,"th"),s(15,"Progress"),r(),o(16,"th"),s(17,"Cancel"),r()()(),o(18,"tbody"),m(19,me,16,8,"tr",9),r()()()),n&2){let t=f();l(19),p("ngForOf",t.uploadedFiles)}}function ue(n,e){if(n&1){let t=C();o(0,"div")(1,"button",22),b("click",function(){u(t);let a=f();return _(a.uploadFiles())}),s(2,"Upload"),r()()}if(n&2){let t=f();l(),p("disabled",t.uploading)}}function _e(n,e){if(n&1&&(o(0,"li"),s(1),r()),n&2){let t=e.$implicit;l(),x(t)}}function he(n,e){if(n&1&&(o(0,"div",23)(1,"p",24),s(2,"Upload Complete:"),r(),o(3,"ul",25),m(4,_e,2,1,"li",9),r()()),n&2){let t=f();l(4),p("ngForOf",t.uploadedFileNames)}}var O=class n{transform(e){return e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(2)} KB`:e<1073741824?`${(e/1048576).toFixed(2)} MB`:`${(e/1073741824).toFixed(2)} GB`}static \u0275fac=function(t){return new(t||n)};static \u0275pipe=E({name:"formatFileSize",type:n,pure:!0})},L=class n{constructor(e,t,i){this.http=e;this.fileService=t;this.cdRef=i;this.fetchUploadedFiles()}fileInput;uploadedFiles=[];filePreviews=[];progress=0;uploading=!1;files=[];canceledFiles=[];isDragOver=!1;uploadErrorMessage=null;isPdf(e){return e.type==="application/pdf"}isWord(e){return e.type==="application/msword"||e.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"}isVideo(e){return e.type.startsWith("video/")}isExcel(e){return e.type==="application/vnd.ms-excel"||e.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}isZip(e){return e.type==="application/zip"||e.name.endsWith(".zip")}currentUploadingIndex=-1;fileProgress={};uploadedFileName="";uploadCompleteMessage="";ngAfterViewInit(){}fetchUploadedFiles(){this.http.get("http://localhost:3001/files").subscribe(e=>{console.log(e),this.files=this.filterFilesUploadedToday(e.files),this.cdRef.detectChanges()},e=>{console.error("Error fetching files:",e)})}filterFilesUploadedToday(e){let t=new Date,i=new Date(t.setHours(0,0,0,0)),a=new Date(t.setHours(23,59,59,999));return e.filter(d=>{let c=new Date(d.uploadedAt);return c>=i&&c<=a})}onFilesSelected(e){let t=Array.from(e.target.files);this.addFilesWithUniqueKeys(t),this.cdRef.detectChanges()}onDrop(e){if(e.preventDefault(),e.dataTransfer?.files){let t=Array.from(e.dataTransfer.files);this.addFilesWithUniqueKeys(t),this.cdRef.detectChanges()}}addFilesWithUniqueKeys(e){e.forEach((t,i)=>{let a=t.name,d=1;for(;this.uploadedFiles.some(g=>g.name===a)||this.isCanceledFile(a);){let g=t.name.substring(0,t.name.lastIndexOf(".")),F=t.name.substring(t.name.lastIndexOf("."));a=`${g} (${d})${F}`,d++}let c=new File([t],a,{type:t.type});this.uploadedFiles.push(c),this.generatePreview(c)})}cancelFileUpload(e){this.canceledFiles.push(e)}isCanceledFile(e){return this.canceledFiles.includes(e)}onDragOver(e){e.preventDefault(),this.isDragOver=!0}onDragLeave(e){this.isDragOver=!1}generatePreview(e){let t=new FileReader;e.type.startsWith("image")?(t.onload=()=>{this.filePreviews.push({file:e,preview:t.result}),this.cdRef.detectChanges()},t.readAsDataURL(e)):e.type==="application/pdf"?(this.filePreviews.push({file:e,preview:"assets/pdf-icon.png"}),this.cdRef.detectChanges()):(this.filePreviews.push({file:e,preview:null}),this.cdRef.detectChanges())}uploadFiles(){this.uploadedFiles.length!==0&&(this.uploading=!0,this.uploadNextFile(0))}finalizeFileName(e){if(this.currentUploadingIndex>=0&&this.currentUploadingIndex<this.uploadedFiles.length){let t=this.uploadedFiles[this.currentUploadingIndex],i=new File([t],e,{type:t.type});this.uploadedFiles[this.currentUploadingIndex]=i}}checkForDuplicateFileName(e){this.http.get("http://localhost:3001/files/existing").subscribe(t=>{let i=e,a=1,d=e.substring(0,e.lastIndexOf(".")),c=e.substring(e.lastIndexOf(".")),g=[...this.uploadedFileNames,...t.existingFiles];for(;g.includes(i);)i=`${d}(${a})${c}`,a++;this.finalizeFileName(i)})}uploadedFileNames=[];uploadNextFile(e){if(e>=this.uploadedFiles.length){this.uploading=!1,this.fetchUploadedFiles(),this.resetUpload();return}let t=this.uploadedFiles[e];this.fileProgress[t.name]=0,this.currentUploadingIndex=e,this.uploadFileToServer(t,e)}uploadFileToServer(e,t){let i=new FormData;i.append("files",e,e.name),this.fileProgress[e.name]=0;let a=Date.now();this.http.post("http://localhost:3001/upload",i,{headers:new h,observe:"events",reportProgress:!0}).subscribe(d=>{if(d.type===P.UploadProgress&&d.total){let c=Math.round(100*d.loaded/d.total);this.fileProgress[e.name]=c,this.cdRef.detectChanges()}else if(d.type===P.Response){let g=d.body.files.map(Z=>Z.filename)||[];this.uploadedFileNames.push(...g);let F=Date.now()-a;setTimeout(()=>{this.uploadNextFile(t+1)},Math.max(500-F,0))}},d=>{console.error("Upload error:",d),this.uploadErrorMessage="There was an error uploading the file.",this.uploadNextFile(t+1)})}removeFile(e){this.uploadedFiles.splice(e,1),this.filePreviews.splice(e,1),this.cdRef.detectChanges()}resetUpload(){this.uploadedFiles=[],this.filePreviews=[],this.fileProgress={},this.uploadedFileName="",this.uploadCompleteMessage="",this.cdRef.detectChanges()}static \u0275fac=function(t){return new(t||n)(v(w),v(y),v(H))};static \u0275cmp=S({type:n,selectors:[["app-dashboard"]],viewQuery:function(t,i){if(t&1&&U(X,5),t&2){let a;z(a=$())&&(i.fileInput=a.first)}},decls:13,vars:7,consts:[["fileInput",""],[1,"upload-container",3,"dragover","dragleave","drop","ngClass"],[1,"material-icons"],["type","file","multiple","","name","files",3,"change"],["class","error-message",4,"ngIf"],[4,"ngIf"],["class","uploaded-message-container",4,"ngIf"],[1,"error-message"],[1,"file-table"],[4,"ngFor","ngForOf"],["class","file-type-icon",4,"ngIf"],["class","progress-container",4,"ngIf"],[1,"cancel-button",3,"click"],[3,"src","alt",4,"ngIf"],[3,"src","alt"],[1,"file-type-icon"],["style","color: #2980b9;",4,"ngIf"],[2,"color","#2980b9"],[1,"progress-container"],[1,"progress"],["role","progressbar",1,"progress-bar"],[2,"color","#2ecc71","font-size","24px"],[3,"click","disabled"],[1,"uploaded-message-container"],[1,"uploaded-message"],[1,"uploaded-files-list"]],template:function(t,i){if(t&1){let a=C();o(0,"div",1),b("dragover",function(c){return u(a),_(i.onDragOver(c))})("dragleave",function(c){return u(a),_(i.onDragLeave(c))})("drop",function(c){return u(a),_(i.onDrop(c))}),o(1,"h2"),s(2," Upload Files "),o(3,"span",2),s(4,"upload"),r()(),o(5,"input",3,0),b("change",function(c){return u(a),_(i.onFilesSelected(c))}),r(),o(7,"p"),s(8,"Or drag and drop your files here"),r(),m(9,te,3,1,"div",4)(10,ge,20,1,"div",5)(11,ue,3,1,"div",5)(12,he,5,1,"div",6),r()}t&2&&(p("ngClass",N(5,ee,i.isDragOver)),l(9),p("ngIf",i.uploadErrorMessage),l(),p("ngIf",i.uploadedFiles&&i.uploadedFiles.length>0),l(),p("ngIf",i.uploadedFiles&&i.uploadedFiles.length>0),l(),p("ngIf",i.uploadedFileNames.length>0))},dependencies:[q,W,j,B,Q,K,O],styles:['html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0;padding:0;background-color:#0e121a;display:flex;justify-content:center;align-items:center;font-family:Orbitron,sans-serif;color:#fff}.upload-container[_ngcontent-%COMP%]{border:2px solid #00f5ff;padding:30px;text-align:center;width:100%;max-width:950px;margin:0 auto;background-color:#1a2431;border-radius:15px;box-sizing:border-box;box-shadow:0 0 30px #00ffff80,0 0 60px #00f5ff4d;transition:all .3s ease-in-out;position:relative;z-index:1}.upload-container[_ngcontent-%COMP%]:hover{transform:scale(1.03);box-shadow:0 0 40px #00ffffb3,0 0 70px #00f5ff80}.upload-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .upload-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-family:Arial,sans-serif}.upload-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:36px;color:#00f5ff}.upload-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:40px;vertical-align:middle;color:#00f5ff;text-shadow:0 0 10px #00f5ff}.upload-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:20px;padding:14px;background-color:#0e121a;border:2px solid #00f5ff;border-radius:10px;color:#fff;transition:background-color .3s,border-color .3s}.upload-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#00f5ff;background-color:#1c2833;outline:none}.upload-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#7f8c8d}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:15px;padding:15px 40px;background-color:#00f5ff;border:none;border-radius:10px;font-size:18px;color:#1a2431;font-weight:700;cursor:pointer;transition:background-color .3s ease,transform .3s ease;box-shadow:0 0 15px #00f5ff66,0 0 30px #00f5ff33}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00d1e6;transform:translateY(-5px)}.upload-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#7f8c8d;box-shadow:none;cursor:not-allowed}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin-bottom:20px;padding:14px;background-color:#34495e;border-radius:10px;box-shadow:0 2px 8px #0003;transition:background-color .3s ease,transform .3s ease}.file-item[_ngcontent-%COMP%]:hover{background-color:#1abc9c;transform:scale(1.03)}.file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}img[_ngcontent-%COMP%]{max-width:50px;max-height:50px;object-fit:cover;border-radius:5px}.file-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#ecf0f1;font-size:16px}.progress-container[_ngcontent-%COMP%]{margin-top:10px;width:100%}.progress-bar[_ngcontent-%COMP%]{height:20px;background:linear-gradient(90deg,#00f5ff,#1abc9c);border-radius:10px;box-shadow:0 0 10px #00f5ff80;transition:width .5s ease}.uploaded-files-list[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background-color:#34495e;border-radius:12px;box-shadow:0 4px 15px #00000026}.uploaded-files-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:20px;color:#ecf0f1;font-size:20px;font-weight:600}.uploaded-files-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0}.uploaded-files-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#fff}.uploaded-files-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#3498db;font-weight:600;font-size:16px;transition:color .3s ease}.uploaded-files-list[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#1abc9c;text-decoration:underline}.uploaded-files-list[_ngcontent-%COMP%]   .file-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.uploaded-message-container[_ngcontent-%COMP%]{margin-top:30px;background:linear-gradient(135deg,#0e121a,#34495e);padding:20px;border-radius:15px;box-shadow:0 4px 20px #000000b3}.uploaded-message[_ngcontent-%COMP%]{color:#00f5ff;font-size:24px;text-shadow:0 0 10px rgba(0,245,255,.5)}@keyframes _ngcontent-%COMP%_neon-glow{0%{text-shadow:0 0 10px #00f5ff,0 0 20px #00f5ff,0 0 30px #00f5ff,0 0 40px #00f5ff}to{text-shadow:0 0 20px #00f5ff,0 0 30px #00f5ff,0 0 40px #00f5ff,0 0 50px #00f5ff}}.upload-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;max-width:800px;height:420px;margin:30px auto;border:1px solid #bdc3c7;background-color:#ecf0f1;border-radius:8px}.file-progress-container[_ngcontent-%COMP%]{margin-top:15px;background-color:#1a2431;border-radius:12px;padding:15px;box-shadow:0 6px 15px #00000080}.progress[_ngcontent-%COMP%]{height:30px;width:100%;background:#2c3e50;border-radius:50px;overflow:hidden;position:relative;box-shadow:0 4px 15px #0000004d}.progress-bar[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-2px;left:0;height:120%;width:40px;background:#ffffff4d;filter:blur(8px);animation:_ngcontent-%COMP%_shimmer 2s infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{left:-40px}to{left:100%}}.progress-bar[_ngcontent-%COMP%]:after{content:attr(data-progress) "%";position:absolute;right:15px;top:0;bottom:0;margin:auto;font-family:Orbitron,sans-serif;font-size:14px;color:#fff;text-shadow:0 0 5px #00f5ff,0 0 10px #1abc9c;line-height:30px}.file-table[_ngcontent-%COMP%]{width:100%;margin-top:20px;background-color:#2c3e50;border-radius:10px;box-shadow:0 4px 15px #00000080}.file-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .file-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:15px;color:#ecf0f1;border-bottom:1px solid #7f8c8d}.file-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:16px;text-transform:uppercase}.file-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#34495e}.file-type-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.mat-icon[_ngcontent-%COMP%]{font-size:24px;color:#2ecc71}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb;padding:15px;margin-top:10px;border-radius:5px;font-size:14px;font-weight:700;text-align:center}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:before{content:"\\26a0";margin-right:10px;font-size:18px}.cancel-button[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}']})};export{L as DashboardComponent,O as FormatFileSizePipe};
